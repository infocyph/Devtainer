<VirtualHost *:443>
    # Site Identity
    ServerName example.com
    ServerAlias www.example.com
    ServerAdmin admin@example.com

    # Document Root (where website files are located)
    DocumentRoot /var/www/html/example.com

    # Directory Configuration
    DirectoryIndex index.php index.html index.htm
    <Directory /var/www/html/example.com>
        Options Indexes FollowSymLinks
        AllowOverride All
        Require all granted
    </Directory>

    # Proxy all requests to Docker PHP-FPM container
    ProxyPass "/" "fcgi://php82-container:9000/var/www/html/example.com/"
    ProxyPassReverse "/" "fcgi://php82-container:9000/var/www/html/example.com/"

    # SSL Configuration
    SSLEngine on
    SSLCertificateFile /etc/apache2/ssl/example.com.crt
    SSLCertificateKeyFile /etc/apache2/ssl/example.com.key
    SSLCertificateChainFile /etc/apache2/ssl/example.com.chain.pem

    # Security Headers
    Header always set Strict-Transport-Security "max-age=31536000; includeSubDomains"
    Header always set X-Frame-Options "SAMEORIGIN"
    Header always set X-Content-Type-Options "nosniff"

    # Gzip Compression
    <IfModule mod_deflate.c>
        AddOutputFilterByType DEFLATE text/html text/plain text/xml text/css application/javascript application/json
    </IfModule>

    # Caching Headers for Static Assets
    <FilesMatch "\.(ico|css|js|gif|jpe?g|png|woff2?)$">
        Header set Cache-Control "max-age=31536000, public"
    </FilesMatch>

    # Log file locations
    ErrorLog ${APACHE_LOG_DIR}/example.com.error.log
    CustomLog ${APACHE_LOG_DIR}/example.com.access.log combined
</VirtualHost>
